<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chart Test</title>
<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
<style>
body {
  font-family: sans-serif;
  margin: 0;
  padding: 20px;
  background-color: #fafafa;
}
.banner {
  display: block;
  max-width: 600px;
  width: 80%;
  margin: 0 auto 40px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}
.chart {
  display: block;
  max-width: 800px;
  width: 100%;
  margin: 0 auto 40px;
  background: white;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  padding: 20px;
  clear: both;
}
.chart-content {
  display: flex;
  justify-content: center;
  margin-bottom: 15px;
}
.chart-description {
  text-align: center;
  color: #666;
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: 15px;
}
#data-sources {
  max-width: 800px;
  margin: 40px auto;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  padding: 20px;
}
#data-sources h2 {
  text-align: center;
  color: #333;
}
#data-sources ul {
  color: #555;
  font-size: 0.95em;
  line-height: 1.6em;
}
#data-sources a {
  color: #1a73e8;
  text-decoration: none;
}
#data-sources a:hover {
  text-decoration: underline;
}
</style>
</head>
<body>

<!-- âœ… Replace title with banner -->
<img src="banner.png" alt="Indian Railways Data Visualization Banner" class="banner">

<div class="chart">
  <div class="chart-content" id="railwaymap"></div>
  <p class="chart-description">This is a placeholder description for the railway map.</p>
</div>

<div class="chart">
  <div class="chart-content" id="symbolmap"></div>
  <p class="chart-description">This is a placeholder description for the symbol map.</p>
</div>

<div class="chart">
  <div class="chart-content" id="piechart"></div>
  <p class="chart-description">This is a placeholder description for the pie chart.</p>
</div>

<div class="chart">
  <div class="chart-content" id="linechart"></div>
  <p class="chart-description">This is a placeholder description for the line chart.</p>
</div>

<div class="chart">
  <div class="chart-content" id="station_linechart"></div>
  <p class="chart-description">This is a placeholder description for the station line chart.</p>
</div>

<div class="chart">
  <div class="chart-content" id="diverging"></div>
  <p class="chart-description">This is a placeholder description for the diverging chart.</p>
</div>

<div class="chart">
  <div class="chart-content" id="freight"></div>
  <p class="chart-description">This is a placeholder description for the freight chart.</p>
</div>

<div class="chart">
  <div class="chart-content" id="barchart"></div>
  <p class="chart-description">This is a placeholder description for the bar chart.</p>
</div>

<div id="data-sources">
  <h2>Data Sources</h2>
  <ul>
    <li><a href="https://example.com/railway-data" target="_blank">Railway Dataset</a></li>
    <li><a href="https://example.com/symbol-data" target="_blank">Symbol Map Dataset</a></li>
    <li><a href="https://example.com/pie-data" target="_blank">Category Dataset</a></li>
    <li><a href="https://example.com/line-data" target="_blank">Time Series Dataset</a></li>
    <li><a href="https://example.com/station-data" target="_blank">Station Usage Dataset</a></li>
    <li><a href="https://example.com/diverging-data" target="_blank">Diverging Dataset</a></li>
    <li><a href="https://example.com/freight-data" target="_blank">Freight Dataset</a></li>
    <li><a href="https://example.com/bar-data" target="_blank">Bar Chart Dataset</a></li>
  </ul>
</div>

<script>
const chartSpecs = [
  "#railwaymap",
  "#symbolmap",
  "#piechart",
  "#linechart",
  "#station_linechart",
  "#diverging",
  "#freight",
  "#barchart"
];

const divergingSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Diverging bar chart comparing Suburban vs Non-Suburban passengers over years",
  "data": {"url": "p_data.csv", "format": {"type": "csv"}},
  "transform": [
    {"calculate": "datum['Passengers Originating - Sub. (In Millions)']", "as": "suburban"},
    {"calculate": "datum['Passengers Originating - Non-Sub. (In Millions)']", "as": "non_suburban"},
    {"fold": ["suburban", "non_suburban"], "as": ["passenger_type", "people"]},
    {"calculate": "datum.passenger_type == 'suburban' ? 'Suburban' : 'Non-Suburban'", "as": "category"},
    {"calculate": "datum.passenger_type == 'suburban' ? -datum.people : datum.people", "as": "signed_people"}
  ],
  "width": 500,
  "height": 600,
  "mark": "bar",
  "encoding": {
    "y": {"field": "Year", "type": "nominal", "axis": {"title": "Year"}, "sort": "descending"},
    "x": {
      "aggregate": "sum",
      "field": "signed_people",
      "title": "Passengers (In Millions)",
      "axis": {"format": "s", "labelExpr": "abs(datum.value)"}
    },
    "color": {
      "field": "category",
      "scale": {"domain": ["Suburban", "Non-Suburban"], "range": ["#6a994e", "#a7c957"]},
      "legend": {"orient": "top", "title": null}
    }
  },
  "config": {"view": {"stroke": null}, "axis": {"grid": false}}
};

const specFiles = {
  "#railwaymap": "railwaymap.vg.json",
  "#symbolmap": "symbolmap.vg.json",
  "#piechart": "piechart.vg.json",
  "#linechart": "linechart.vg.json",
  "#station_linechart": "station_linechart.vg.json",
  "#freight": "freight.vg.json",
  "#barchart": "barchart.vg.json"
};

vegaEmbed("#diverging", divergingSpec, {
  actions: { export: true, source: true, editor: true, compiled: false },
  renderer: "svg"
}).catch(err => {
  document.querySelector("#diverging").innerHTML = "<p>Failed to load chart</p>";
  console.error(err);
});

for (const id of chartSpecs) {
  if (id === "#diverging") continue;
  fetch(specFiles[id])
    .then(resp => resp.json())
    .then(spec => {
      vegaEmbed(id, spec, {
        actions: { export: true, source: true, editor: true, compiled: false },
        renderer: "svg"
      });
    })
    .catch(err => {
      document.querySelector(id).innerHTML = "<p>Failed to load chart</p>";
      console.error(err);
    });
}
</script>
</body>
</html>